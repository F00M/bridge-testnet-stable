<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bridge Testnet Stable</title>
<meta name="theme-color" content="#0f1610" />
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
<style>
  :root{
    --bg1:#0e1510; --bg2:#0a120b;
    --card:#101910; --muted:#203520; --field:#0c150d;
    --acc1:#22c55e; --acc2:#16a34a; --txt:#e8f3e9; --sub:#a9c7af;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;
    background: radial-gradient(circle at 20% -20%, var(--bg1), var(--bg2) 60%);
    color:var(--txt); font-family:'Poppins',sans-serif;
    padding:56px 12px 48px;
  }
  .lzbrand {
    position: fixed; top: 12px; left: 14px;
    display: flex; align-items: center; gap: 8px;
    z-index: 9999; text-decoration: none;
  }
  .lzbrand svg { height: 28px; width: auto; }
  .lzbrand .word { font-weight: 700; font-size: 14px; color: #e8f3e9; opacity:.9 }

  .wrap{width:min(420px,94vw)}
  .card{
    background: linear-gradient(180deg, rgba(16,25,16,.86), rgba(12,19,12,.86));
    border:1px solid var(--muted); border-radius:16px; padding:22px;
    box-shadow:0 12px 28px rgba(0,0,0,.35);
  }
  h2{margin:0 0 10px; color:var(--acc1); font-size:20px; text-align:center}
  label{display:block; font-size:12px; color:var(--sub); margin-top:8px}
  input{
    width:100%; padding:12px; margin-top:6px; border-radius:10px;
    border:1px solid var(--muted); background:var(--field); color:#fff; font-size:14px;
  }
  button{
    width:100%; padding:12px; border-radius:10px; border:0;
    font-weight:700; cursor:pointer; margin-top:10px;
    color:#06110a; background:linear-gradient(90deg,var(--acc1),var(--acc2));
  }
  button.secondary{background:#223a23; color:#cfe9d4}
  pre{
    white-space:pre-wrap; background:var(--field); border:1px solid var(--muted);
    border-radius:12px; padding:14px; margin-top:14px; min-height:100px;
    color:#dff8e6; font-size:13px;
  }
  footer{position:fixed; bottom:10px; left:0; right:0; text-align:center; color:#8fcfa0; font-size:12px}
</style>
</head>
<body>

<a class="lzbrand" href="#" aria-label="LayerZero">
  <svg viewBox="0 0 128 128"><path d="M28 24h20v60h52v20h-72z" fill="#fff"/></svg>
  <span class="word">LayerZero</span>
</a>

<div class="wrap">
  <div class="card">
    <h2>üåâ Bridge Testnet Stable</h2>

    <button id="connect" class="secondary">üîå Connect Wallet</button>
    <p id="status">Wallet: -</p>

    <hr style="border:0;border-top:1px solid #203520;margin:16px 0">

    <h3 style="color:#22c55e;text-align:center">Bridge USDT0 ‚Üí Stable</h3>
    <label>Jumlah (USDT0)</label>
    <input id="amount" placeholder="contoh: 10" />
    <button id="approve">‚úÖ Approve</button>
    <button id="bridge">üöÄ Bridge Sekarang</button>

    <hr style="border:0;border-top:1px solid #203520;margin:16px 0">

    <h3 style="color:#22c55e;text-align:center">üíß Unwrap ke gUSDT</h3>
    <label>Jumlah (USDT0)</label>
    <input id="unwrapAmount" placeholder="contoh: 10" />
    <button id="unwrap">üöÄ Unwrap Sekarang</button>
    <p id="balance">Saldo: -</p>

    <pre id="log">log siap...</pre>
  </div>
</div>

<footer>by thdx</footer>

<script>
const CONFIG = {
  STABLE: { id:2201, hex:"0x899", rpc:"https://stable-jsonrpc.testnet.chain0.dev" },
  SEPOLIA: { id:11155111, hex:"0xaa36a7" },
  token: "0xc4DCC311c028e341fd8602D8eB89c5de94625927",   // USDT0
  adapter: "0xc099cD946d5efCC35A99D64E808c1430cEf08126", // OFT adapter
  wrapper: "0xcAB8F3ed8528655E0C2fad1C504c6CfEccf50B90"  // depositTo
};

const ERC20_ABI = [
  "function approve(address,uint256) returns(bool)",
  "function balanceOf(address) view returns (uint256)"
];
const OFT_ABI = [
  "function quoteSend((uint32,bytes32,uint256,uint256,bytes,bytes,bytes),bool)view returns(uint256 nativeFee,uint256 zroFee)",
  "function send((uint32,bytes32,uint256,uint256,bytes,bytes,bytes),(uint256,uint256),address)payable"
];
const WRAP_ABI = ["function depositTo(address,uint256) external"];

const $ = id=>document.getElementById(id);
const log = m=>{const el=$("log");el.textContent+=(el.textContent?"\n":"")+m;el.scrollTop=el.scrollHeight;console.log(m);};

let provider, signer, me;

async function connect(){
  try{
    if(!window.ethereum) throw new Error("Gunakan MetaMask / OKX Wallet");
    provider=new ethers.providers.Web3Provider(window.ethereum,"any");
    await provider.send("eth_requestAccounts",[]);
    signer=provider.getSigner(); me=await signer.getAddress();
    const net=await provider.getNetwork();
    $("status").textContent=`Wallet: ${me.slice(0,6)}...${me.slice(-4)} | Chain: ${net.chainId}`;
    log(`‚úÖ Connected: ${me}\nChain: ${net.chainId}`);
    updateBalance();
  }catch(e){log("‚ùå Connect error: "+e.message);}
}

async function approve(){
  try{
    const amt=$("amount").value.trim(); if(!amt) return log("‚ö†Ô∏è Masukkan jumlah token");
    const val=ethers.utils.parseUnits(amt,"6");
    const erc=new ethers.Contract(CONFIG.token,ERC20_ABI,signer);
    log("üßæ Approving...");
    const tx=await erc.approve(CONFIG.adapter,val);
    log("‚è≥ TX: "+tx.hash);
    await tx.wait(); log("‚úÖ Approve sukses!");
  }catch(e){log("‚ùå Approve error: "+e.message);}
}

async function bridge(){
  try{
    const amt=$("amount").value.trim(); if(!amt)return log("‚ö†Ô∏è Masukkan jumlah token");
    const amountLD=ethers.utils.parseUnits(amt,"6");
    const to32="0x"+me.replace(/^0x/,"").padStart(64,"0");
    const oft=new ethers.Contract(CONFIG.adapter,OFT_ABI,signer);
    const sendParams=[40374,to32,amountLD,amountLD,"0x","0x","0x"];
    log("1Ô∏è‚É£ Estimating fee...");
    const fee=await oft.quoteSend(sendParams,false);
    const nativeFee=ethers.BigNumber.from(fee.nativeFee||fee[0]);
    log(`üí∞ Fee: ${ethers.utils.formatEther(nativeFee)} ETH`);
    const tx=await oft.send(sendParams,[nativeFee,0],me,{value:nativeFee,gasLimit:350000});
    log(`‚è≥ TX: ${tx.hash}`);
    await tx.wait();
    log("‚úÖ Bridge sukses! Tunggu token di Stable Testnet.");
  }catch(e){log("‚ùå Bridge error: "+(e.message||e));}
}

async function unwrap(){
  try{
    const amt=$("unwrapAmount").value.trim(); if(!amt)return log("‚ö†Ô∏è Masukkan jumlah");
    const val=ethers.utils.parseUnits(amt,"6");
    const erc=new ethers.Contract(CONFIG.token,ERC20_ABI,signer);
    const bal=await erc.balanceOf(me);
    if(bal.lt(val))return log("‚ùå Saldo USDT0 tidak cukup.");
    log("üßæ Approving ke wrapper...");
    const txA=await erc.approve(CONFIG.wrapper,val);
    await txA.wait(); log("‚úÖ Approve sukses!");
    const wrap=new ethers.Contract(CONFIG.wrapper,WRAP_ABI,signer);
    const txB=await wrap.depositTo(me,val);
    log("üöÄ TX: "+txB.hash);
    await txB.wait();
    log("‚úÖ Unwrap sukses (gUSDT diterima)");
    updateBalance();
  }catch(e){log("‚ùå Unwrap error: "+(e.message||e));}
}

async function updateBalance(){
  try{
    const erc=new ethers.Contract(CONFIG.token,ERC20_ABI,provider);
    const bal=await erc.balanceOf(me);
    $("balance").textContent=`Saldo: ${ethers.utils.formatUnits(bal,6)} USDT0`;
  }catch{ $("balance").textContent="Saldo: -" }
}

$("connect").onclick=connect;
$("approve").onclick=approve;
$("bridge").onclick=bridge;
$("unwrap").onclick=unwrap;
</script>
</body>
</html>
